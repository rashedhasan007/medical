import json
from web3 import Web3

# Set up web3 connection with Ganache
ganache_url = "http://127.0.0.1:7545"
web3 = Web3(Web3.HTTPProvider(ganache_url))
with open('smart_contract.txt') as json_file:
    abi = json.load(json_file)
	
bytecode = "60606040526220f580600355341561001657600080fd5b5b611618806100266000396000f300606060405236156100ad576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680631b6e23ea146100b257806342ac87cf146100ff5780634d15a9bb1461019f5780634e6bd1c0146101f9578063670d14b2146102ef578063857cdbb814610447578063c45d9bea14610567578063de6f24bb14610679578063e0c01bfe146106f5578063edc8f0d8146107e2578063f1703b911461082f575b600080fd5b34156100bd57600080fd5b6100e9600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610858565b6040518082815260200191505060405180910390f35b341561010a57600080fd5b61019d600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610870565b005b34156101aa57600080fd5b6101df600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610a45565b604051808215151515815260200191505060405180910390f35b341561020457600080fd5b610239600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610aaa565b604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001838152602001828103825284818151815260200191508051906020019080838360005b838110156102b25780820151818401525b602081019050610296565b50505050905090810190601f1680156102df5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b34156102fa57600080fd5b610326600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610c84565b6040518080602001806020018381038352858181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156103b35780601f10610388576101008083540402835291602001916103b3565b820191906000526020600020905b81548152906001019060200180831161039657829003601f168201915b50508381038252848181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156104365780601f1061040b57610100808354040283529160200191610436565b820191906000526020600020905b81548152906001019060200180831161041957829003601f168201915b505094505050505060405180910390f35b341561045257600080fd5b61047e600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050610ca6565b604051808060200180602001838103835285818151815260200191508051906020019080838360005b838110156104c35780820151818401525b6020810190506104a7565b50505050905090810190601f1680156104f05780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b8381101561052a5780820151818401525b60208101905061050e565b50505050905090810190601f1680156105575780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b341561057257600080fd5b6105a7600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035906020019091905050610e7c565b604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001806020018381526020018281038252848181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156106685780601f1061063d57610100808354040283529160200191610668565b820191906000526020600020905b81548152906001019060200180831161064b57829003601f168201915b505094505050505060405180910390f35b341561068457600080fd5b6106f3600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610ed2565b005b341561070057600080fd5b61072c600480803573ffffffffffffffffffffffffffffffffffffffff16906020019091905050611204565b604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200180602001838152602001828103825284818151815260200191508051906020019080838360005b838110156107a55780820151818401525b602081019050610789565b50505050905090810190601f1680156107d25780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b34156107ed57600080fd5b610819600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506114e4565b6040518082815260200191505060405180910390f35b341561083a57600080fd5b61084261152d565b6040518082815260200191505060405180910390f35b60006020528060005260406000206000915090505481565b81600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000190805190602001906108c6929190611533565b5080600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101908051906020019061091d929190611533565b503373ffffffffffffffffffffffffffffffffffffffff167fe963a0dc3358a0b8e4c9c301f3003bfbd501c8b1ca3497838a39b6e7208d4e328383604051808060200180602001838103835285818151815260200191508051906020019080838360005b8381101561099d5780820151818401525b602081019050610981565b50505050905090810190601f1680156109ca5780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b83811015610a045780820151818401525b6020810190506109e8565b50505050905090810190601f168015610a315780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a25b5050565b600042600354600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600085815260200190815260200160002060020154011190505b92915050565b6000610ab46115b3565b6000600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600060018603815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000600187038152602001908152602001600020600101600160008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600060018803815260200190815260200160002060020154818054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c6f5780601f10610c4457610100808354040283529160200191610c6f565b820191906000526020600020905b815481529060010190602001808311610c5257829003601f168201915b505050505091509250925092505b9250925092565b6002602052806000526040600020600091509050806000019080600101905082565b610cae6115b3565b610cb66115b3565b600260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001600260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101818054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610dcf5780601f10610da457610100808354040283529160200191610dcf565b820191906000526020600020905b815481529060010190602001808311610db257829003601f168201915b50505050509150808054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610e6b5780601f10610e4057610100808354040283529160200191610e6b565b820191906000526020600020905b815481529060010190602001808311610e4e57829003601f168201915b50505050509050915091505b915091565b6001602052816000526040600020602052806000526040600020600091509150508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169080600101908060020154905083565b33600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054815260200190815260200160002060000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205481526020019081526020016000206001019080519060200190611047929190611533565b5042600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548152602001908152602001600020600201819055506000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600081548092919060010191905055508173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fdd99aef5e4fdfad84059320be40f5dc0f015dc4025f56bd4010608c6743bc22e42846040518083815260200180602001828103825283818151815260200191508051906020019080838360005b838110156111c45780820151818401525b6020810190506111a8565b50505050905090810190601f1680156111f15780820380516001836020036101000a031916815260200191505b50935050505060405180910390a35b5050565b600061120e6115b3565b6000806000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205411151561125c57600080fd5b600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600060016000808873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205403815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600060016000808973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054038152602001908152602001600020600101600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600060016000808a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205403815260200190815260200160002060020154818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114cf5780601f106114a4576101008083540402835291602001916114cf565b820191906000526020600020905b8154815290600101906020018083116114b257829003601f168201915b505050505091509250925092505b9193909250565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205490505b919050565b60035481565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061157457805160ff19168380011785556115a2565b828001600101855582156115a2579182015b828111156115a1578251825591602001919060010190611586565b5b5090506115af91906115c7565b5090565b602060405190810160405280600081525090565b6115e991905b808211156115e55760008160009055506001016115cd565b5090565b905600a165627a7a72305820636861edebdce7804b25225be852f9486c0d4f82f5d4257aa1def5f1bfbf86620029"
	
# set pre-funded account as sender
#web3.eth.defaultAccount = web3.eth.accounts[0]
web3.eth.defaultAccount='0x04675c3BDdBD471d6A4A5adA98055F8Fd2B781d2'
# Instantiate and deploy contract
Greeter = web3.eth.contract(abi=abi, bytecode=bytecode)

# Submit the transaction that deploys the contract
tx_hash = Greeter.constructor().transact()

# Wait for the transaction to be mined, and get the transaction receipt
tx_receipt = web3.eth.waitForTransactionReceipt(tx_hash)

# Create the contract instance with the newly-deployed address
contract = web3.eth.contract(
    address=tx_receipt.contractAddress,
    abi=abi,
)

print(tx_receipt.contractAddress)

contract.functions.sendMessage('0x04675c3BDdBD471d6A4A5adA98055F8Fd2B781d2','hi').transact()
#contract.functions.sendMessage('0xba6956D38467053856c557Eaf836455DE851B12A','h222i').transact()
#contract.functions.sendMessage('0x1931aD2551652c4ea5b28a727eCEa8e51AE991a7','hi rashed').transact()
#contract.functions.sendMessage('0xF9957C977deb5FE9F65B96d2BE65B1A0E30429aC','hi sanjida ').transact()
#print(contract.functions.getLastMessage('0xba6956D38467053856c557Eaf836455DE851B12A').call())
print(contract.functions.getLastMessage('0x04675c3BDdBD471d6A4A5adA98055F8Fd2B781d2').call())